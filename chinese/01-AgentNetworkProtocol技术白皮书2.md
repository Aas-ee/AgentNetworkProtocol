
# AgentNetworkProtocol Framework：一种用于智能体通信的协议框架

## 摘要  

本文提出了一种用于智能体通信的协议框架，使用该协议框架下的协议，智能体xxx，能够组成一个xxx智能体网络。它能能够让任意两个智能体之间进行低成本、去中心化的身份认证，而不用依赖任何中心化机构，同时也可以让智能体之间进行端到端加密通信，以及更加智能、高效的协作。虽然当前互联网基础设施发展已经非常完善，但是智能体组成的网络有其特殊性。要想充分的发挥AI的作用，往往需要让AI能够处理一个人的所有的信息，这就要求我们必须打破现有互联网的数据孤岛。同时，智能体之间的协作应该会更加的智能，他们可以自己组网完成复杂任务。为此，我们提出提出了一个适用于智能体通信的协议框架，此框架整体上分为三层：身份与加密通信层、元协议层、应用协议层。本文不对具体的技术细节展开，将重点描述整体协议框架设计，以我们对未来智能体网络的设想。

## 1. 简介

智能体将成为继Android、iOS之后的下一个重要平台，然而智能体之间如何进行通信，智能体如何连接成一个网络，目前还没有一个标准化的方案。虽然当前互联网基础设施已经相当完善，但是智能体组成的网络有其特殊性，当前的互联网技术无法完全满足智能体网络的需求。首先，智能体往往需要用户的所有信息，才能够做出正确的决策和行动，而当前互联网的数据孤岛效应使一个人数据割裂在不同的平台，智能体很难在决策或行动时获得网站的信息，这正在限制智能体能力的发挥。其次，当前的互联网应用大部分面向人类使用而设计，它们往往提供的是人类更擅长的图形化用户接口，而智能体则更加擅长使用协议或API直接处理底层数据，而使用非图形化接口，让智能体模仿人类使用图形化接口将会耗费更高的成本。最后，智能体可以将自然语言用于网络连接，比如使用自然语言协商双方的能力，使用自然语言协商双方通信协议，这将使智能体通信更加的个性化，使智能体网络具备自我组织、自我协商的能力。所以，我们需要一个新的协议框架，它应该能够使任何两个智能体之间都能够进行连接与通信，打破数据孤岛，让信息自由流动，为智能体提供完整的上下文信息，以做出更加智能的决策；它能够定义专门面向人工智能的数据接口，用人工智能最擅长的方式为智能体提供数据接口，降低智能体处理信息的成本；它能够让智能体之间在没有人类的协助下自主连接、协商、协作。在这篇论文中，我们将提出一个三层的智能体通信协议框架：身份与加密通信层、元协议层、应用协议层，来尝试解决智能体通信面临的难题。

## 2. 协议三层架构

我们提出的三层的协议架构整体设计如下：

![协议三层架构](/images/protocol-layer-design.png)

- 身份与加密通信层：在这个层次，我们将定义一系列的规范，用于解决智能体之间的身份认证问题，特别是跨平台的身份认证，并且提供了一个端到端的加密通信方案。我们设计了一个基于W3C DID的去中心化的身份认证方案，能够让任意两个平台的智能体之间进行身份认证。

- 元协议层：元协议层定义了智能体之间如何使用自然语言协商能力，如何使用自然语言协商通信协议，以及如何使用自然语言进行通信协议的联调。

- 应用协议层：应用协议层定义了智能体如何描述自己的能力以及支持的协议，如何加载协议以及协议处理代码。


### 2.1 身份与加密通信层（再研究下DID规范）

让所有的智能体之间能够相互连接，第一步是要解决智能体之间的身份认证问题。当前互联网应用大部分采用中心化身份技术，不同的技术实现使两个系统的账户之间很难进行身份认证。虽然Oauth技术能够部分的解决此问题[]，但是由于Oauth不是专门为身份的跨系统认证而设计，Oauth流程相对复杂。为此，我们需要一个便捷、跨平台、去中心化的身份认证技术[]。

基于区块链的去中心身份认证方案虽然也可以解决这个问题，但是由于区块链在大规模应用上面临的扩展性挑战[]，使得其在现阶段难以成为最优的解决方案。

W3C DID（Decentralized Identifier，去中心化标识符）是一种新型标识符标准，旨在解决传统中心化身份管理系统的依赖问题。它使用户能够掌握自己的身份并进行相互认证，无需依赖中心化系统。DID核心规范并未限制实现者采用何种计算基础设施构建去中心化标识符，这使得我们可以充分利用现有的成熟技术和完善的web基础设施构建去中心化标识符。同时，几乎所有类型的标识符系统都可以添加对 DID 的支持，这将在集中式、联合式和去中心化标识符的世界之间架起了一座互操作性桥梁。现有的很多中心化标识符系统无需彻底重构，只需要在中心化标识符基础上创建去中心化标识符，即可与其他的系统进行互操作，这将极大的降低技术实施的难度。

![DID作为不同系统之间的身份认证桥梁](/images/did-as-identity-bridge.png)

DID的核心是DID文档，文档中包含与特定DID相关的关键信息，用于验证DID所有者的身份，并支持对DID相关的操作、权限和访问控制进行管理。

![DID 架构概述及基本组件之间的关系](/images/did-architecture.png)

DID文档包含用于验证用户身份的方法和相应的公钥（私钥用户自己保管）。当用户向服务提供者发起请求，而服务提供者需要验证用户身份时，会向用户发送身份验证要求（通常为挑战信息）。用户使用其私钥对挑战信息进行签名，并将签名结果返回给服务提供者。服务提供者随后使用用户的公钥验证签名，以确认用户的身份。使用DID进行身份验证的核心在于，验证者使用可信任的公钥，对用户签名信息进行验证，整个过程非常的简单。

![DID身份验证基本过程](/images/did-identity-authentication.png)

DID方法定义了如何创建、解析、更新和停用 DID 和 DID 文档，以及如何进行身份验证和授权。现有的DID方法草案中，web方法[]基于成熟的web技术构建。它允许系统使用中心化的技术比如云计算，来创建、更新、停用DID和DID文档，同时不同的系统之间使用http协议来进行互操作。最终效果类似于互联网email服务，既能够大规模的实施，又能够方便的进行跨平台的身份认证。我们在web方法的基础之上，针对智能体通信的场景，添加了跨平台身份认证流程、智能体描述服务等规范，提出了一个新的DID方法wba(web-based agent)。

同时，由于用户一般都会为DID创建一个或多个公私钥对，这些公私钥对不但可以用于身份验证，也可以用于端到端的加密通信。我们基于DID的公私钥对，使用ECDHE（Elliptic Curve Diffie-Hellman Ephemeral，一种基于椭圆曲线的密钥交换协议），设计了一个端到端的加密通信方案。这可以让两个DID之间进行端到端的加密通信，中间节点无法解密通信内容。

### 2.2 元协议层

元协议（Meta-Protocol）是一种定义通信协议操作、解析、组合和交互规则的高级协议。它本质上是一个"协商通信使用协议的协议"，不直接处理具体数据传输，而是提供一个灵活、通用且可扩展的通信框架。

智能体之间的通信常见的有两种方法，第一种是人类工程师设计它们之间通信协议（比如常见的行业标准），并且开发协议代码，联调、测试、部署协议；第二种是智能体之间直接使用直接自然语言通信，在智能体内部直接使用LLM对自然语言数据进行处理。第一种方法往往面临协议开发成本高、协议更新迭代慢、协议难以适应新的场景等问题。第二种方法则面临数据处理成本高、数据处理准确率低等问题。

而使用元协议同时结合AI生成代码的能力，能够极大地提高智能体之间的通信效率，降低通信成本，并且保持智能体之间通信的灵活性和个性化。使用元协议进行通信的基本过程如下：

- 智能体A首先向智能体B发送一个元协议请求，请求主体使用自然语言描述自己的需求，输入，期望获得的输出，以及A提出的候选通信协议。候选通信协议一般包括传输层协议、数据格式、数据处理方式等。

- 智能体B收到元协议请求后，使用AI处理请求中的自然语言描述，同时结合自己的能力，判断是否接受A的请求，以及A提出的候选协议。如果B的能力无法满足A的请求，则直接拒绝；如果B不接受A的候选协议，则B可以提出自己的候选协议，进入下一轮协议协商。直到双方达成一致，或者协商失败为止。

- 双方达成一致后，各自根据协议生成协议处理的代码，并且进行部署。

- 代码部署完毕后，双方协商协议联调的测试数据，对协议以及AI生成的协议处理代码进行联调。

- 联调完毕后，协议正式上线，后续智能体A和智能体B之间开始使用最终协商的协议进行通信，并且使用AI生成的代码处理数据。

- 如果需求发生变化，则重复上述过程，直到双方协商一致为止。

![元协议通信基本过程](/images/meta-protocol-communication.png)

元协议协商过程耗时相对较长，并且依赖AI代码生成能力。如果每次通信都进行元协议协商，将会带来巨大的成本消耗以及糟糕的交互体验。由于智能体之间存在大量相同或类似的通信过程，智能体可以将元协议协商的结果保存下来，后续遇到类似需求时，可以直接使用上次协商结果作为正式协议进行通信，或作为候选协议进行协商。同时，智能体也可以分享协商结果，以供其他智能体查询、使用。如何在经济上激励智能体主动上传自己的协商结果，并且选举出智能体之间的共识协议，是元协议层仍然需要继续研究的问题。

### 2.3 应用协议层

为了降低成本、提供更好的交互体验，在大部分通信场景中，智能体应该避免使用元协议进行通信协议协商。为此，在应用协议层，我们应该设计一套智能体能力与支持协议描述、应用协议管理等规范，以让智能体之间能够更加便捷、低成本的进行通信。

智能体能力与支持协议描述规范明确了智能体如何描述自己支持的能力，以及通过什么协议来调用这些能力。智能体可以将自己的描述文档发布到互联网，或者发布到特定的智能体搜索服务中，以供其他智能体查询、调用。

应用协议管理规范明确了应用协议的文档规范、协议元数据规范（协议版本、时间、创建者等）、协议文档查询与下载方法。应用协议应该包含协议的版本、功能描述、输入输出数据格式、协议处理流程、以及经过签名的可信任的协议处理代码。应用协议可以是人类定义的，也可以是智能体之间协商的共识协议，或者智能体之间协商的个性化协议。协议代码应该包含请求方发起应用协议请求的代码，以及响应方处理应用协议请求的代码。同时，协议代码要经过可信DID的签名，以保证协议代码的安全性。未来应该有一个类似pypi之类的协议服务，来管理应用层协议。智能体可以查找并使用已经定义好的协议及代码，对外提供服务。在调用其他智能体的服务时，也可以根据对方支持的协议，加载对应的协议代码并且调用对方服务。

以智能体A调用其他智能体的服务为例，智能体A可以先通过类似于搜索的查询服务，发现智能体B能够满足自己的需求。然后根据智能体B的能力描述文档，找到对应的协议，通过协议服务加载协议处理代码。最后，A使用协议处理代码，调用B的服务。

![智能体A调用智能体B的服务](/images/agent-a-call-agent-b.png)

协议的具体数据格式不做限制，可以是json、openapi、protobuf等行业标准格式。

## 3. 展望

我们提出的三层协议架构模型虽然能够解决部分问题，但是仍然有些问题需要继续探索。举例来说：
- 是否有比W3C DID更好的跨平台身份认证技术？DID作为一个新发布的推荐标准，基础设施仍然不够成熟。
- 我们方案的一个前提是尽量重复利用当前web基础设施，这能降低技术实施的难度，但这也回避了部分问题。比如，HTTP协议是否仍然是最适合智能体的底层协议，是否有更适合智能体通信的方案？
- 当区块链技术成熟之后，是否可以基于区块链来构建智能体网络？区块链具有天然的去中心化特性，强调个人数据主权，能够让AI更加容易的访问到用户所有数据。同时区块链的金融属性，也可以解决智能体上传协商协议的面临的经济激励难题。

## 4. 总结

本文提出了一种三层协议架构，旨在解决智能体网络通信中的身份认证、协议协商和应用协议管理问题。通过引入基于W3C DID的去中心化身份认证方案，我们为智能体提供了跨平台的身份认证能力，并设计了端到端的加密通信方案。元协议层通过自然语言协商和AI生成代码的能力，提升了智能体之间的通信效率和灵活性。应用协议层则通过规范化的协议描述和管理，降低了通信成本，提升了交互体验。尽管该架构在解决智能体通信问题上取得了一定进展，但仍需进一步探索更优的身份认证技术和底层通信协议，以应对未来智能体网络的复杂需求。

## 参考文献
[1] 比尔盖茨，AI is about to completely change how you use computers，[https://www.gatesnotes.com/AI-agents](https://www.gatesnotes.com/AI-agents)

[2] 智能体网络相关资料

[3] 为什么数据孤岛是中心化身份的比如结果，为什么解决身份问题是解决数据孤岛的第一步

[] 什么是去中心化的身份认证技术

[] Oauth2.0协议

[4] 为什么区块链还不具备大规模落地的条件

[2] W3C DID(Decentralized Identifier)规范，[https://www.w3.org/TR/did-core/](https://www.w3.org/TR/did-core/)

[3] TLS(Transport Layer Security)1.3规范，[https://www.rfc-editor.org/info/rfc8446](https://www.rfc-editor.org/info/rfc8446)

[4] DID all方法设计规范，[02-did:all方法设计规范](02-did%3Aall方法设计规范.md)

[5] 基于DID的端到端加密通信技术，[03-基于did:all方法的端到端加密通信技术协议](03-基于did%3Aall方法的端到端加密通信技术协议.md)


https://www.w3.org/TR/did-use-cases/